<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduVerse - Nova Instituição</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #e8f5e9; display: flex; justify-content: center; padding: 20px; }
        .container { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 600px; border-top: 5px solid #2e7d32; }
        h2 { text-align: center; color: #2e7d32; margin-bottom: 20px; }

        .form-row { display: flex; gap: 15px; }
        .form-group { margin-bottom: 15px; flex: 1; }

        label { display: block; margin-bottom: 5px; color: #444; font-weight: 600; font-size: 0.9rem; }
        input, textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        textarea { height: 80px; resize: vertical; }
        input:focus, textarea:focus { border-color: #2e7d32; outline: none; }

        .hint { font-size: 0.8rem; color: #888; margin-top: 2px; }

        button { width: 100%; padding: 12px; background-color: #2e7d32; color: white; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer; transition: 0.3s; font-weight: bold; margin-top: 10px; }
        button:hover { background-color: #1b5e20; }

        #response { margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-family: monospace; display: none; }
        .success { color: green; border-left: 4px solid green; }
        .error { color: red; border-left: 4px solid red; }
    </style>
</head>
<body>

<div class="container">
    <h2>Cadastrar Instituição</h2>
    <form id="instForm">

        <div class="form-group">
            <label>Nome da Instituição</label>
            <input type="text" id="name" required placeholder="Ex: Universidade Federal...">
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Email Corporativo</label>
                <input type="email" id="email" required placeholder="contato@uni.edu.br">
            </div>
            <div class="form-group">
                <label>Anos de Existência</label>
                <input type="number" id="age" required style="width: 100px;">
            </div>
        </div>

        <div class="form-group">
            <label>Senha</label>
            <input type="password" id="password" required>
        </div>

        <div class="form-group">
            <label>Telefone</label>
            <input type="text" id="phone_number" placeholder="(00) 0000-0000">
        </div>

        <div class="form-group">
            <label>Descrição / Sobre</label>
            <textarea id="description" placeholder="Uma breve descrição da instituição..."></textarea>
        </div>

        <div class="form-group">
            <label>Turmas Iniciais (Opcional)</label>
            <input type="text" id="classes" placeholder="Ex: 1A, 2B, Manhã">
            <div class="hint">Separe por vírgula</div>
        </div>

        <button type="submit">Finalizar Cadastro</button>
    </form>

    <div id="response"></div>
</div>

<script>
    // ATENÇÃO: Verifique se no Controller está @RequestMapping("/instituitions") e @PostMapping("/new-instituition")
    // Se o seu Controller estiver "/instituition" (singular), mude aqui.
    const API_URL = "http://localhost:3080/instituitions/new-instituition";

    document.getElementById('instForm').addEventListener('submit', function(event) {
        event.preventDefault();

        const responseArea = document.getElementById('response');
        responseArea.style.display = 'block';
        responseArea.textContent = "Processando...";
        responseArea.className = "";

        const toList = (str) => str ? str.split(',').map(s => s.trim()).filter(s => s.length > 0) : [];

        const data = {
            name: document.getElementById('name').value,
            age: parseInt(document.getElementById('age').value) || 0,
            email: document.getElementById('email').value,
            password: document.getElementById('password').value,
            phone_number: document.getElementById('phone_number').value,
            description: document.getElementById('description').value,

            // Listas iniciadas
            classes: toList(document.getElementById('classes').value),
            teachers: [], // Começa vazio
            students: [], // Começa vazio

            salt: "" // Backend gera isso
        };

        console.log("Enviando JSON:", data);

        fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
            .then(async response => {
                if (response.ok) {
                    const resData = await response.json();
                    responseArea.textContent = 'Instituição criada com Sucesso! ID: ' + resData.id;
                    responseArea.className = 'success';
                    document.getElementById('instForm').reset();
                } else {
                    const text = await response.text();
                    throw new Error(text || "Erro desconhecido");
                }
            })
            .catch(error => {
                responseArea.textContent = 'Erro: ' + error.message;
                responseArea.className = 'error';
            });
    });
</script>

</body>
</html>