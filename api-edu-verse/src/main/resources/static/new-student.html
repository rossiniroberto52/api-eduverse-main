<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduVerse - Novo Aluno</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #e3f2fd; display: flex; justify-content: center; padding: 20px; }
        .container { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 600px; border-top: 5px solid #1565c0; }
        h2 { text-align: center; color: #1565c0; margin-bottom: 20px; }

        .form-row { display: flex; gap: 15px; }
        .form-group { margin-bottom: 15px; flex: 1; }

        label { display: block; margin-bottom: 5px; color: #444; font-weight: 600; font-size: 0.9rem; }
        input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        input:focus { border-color: #1565c0; outline: none; }

        .hint { font-size: 0.8rem; color: #888; margin-top: 2px; }

        button { width: 100%; padding: 12px; background-color: #1565c0; color: white; border: none; border-radius: 6px; font-size: 1rem; cursor: pointer; transition: 0.3s; font-weight: bold; margin-top: 10px; }
        button:hover { background-color: #0d47a1; }

        #response { margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px; font-family: monospace; font-size: 0.9rem; white-space: pre-wrap; display: none; }
        .success { color: green; border-left: 4px solid green; }
        .error { color: red; border-left: 4px solid red; }
    </style>
</head>
<body>

<div class="container">
    <h2>Cadastrar Novo Aluno</h2>
    <form id="studentForm">

        <div class="form-group">
            <label>Nome Completo</label>
            <input type="text" id="name" required placeholder="Ex: João da Silva">
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>Email</label>
                <input type="email" id="email" required placeholder="joao@email.com">
            </div>
            <div class="form-group">
                <label>Idade</label>
                <input type="number" id="age" required style="width: 80px;">
            </div>
        </div>

        <div class="form-group">
            <label>Senha</label>
            <input type="password" id="password" required placeholder="Crie uma senha forte">
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>CPF</label>
                <input type="text" id="cpf" placeholder="000.000.000-00">
            </div>
            <div class="form-group">
                <label>Telefone</label>
                <input type="text" id="phone_number" placeholder="(00) 90000-0000">
            </div>
        </div>

        <div class="form-group">
            <label>Instituição</label>
            <input type="text" id="institution" placeholder="Ex: Escola Estadual...">
        </div>

        <div class="form-group">
            <label>Tags (Interesses)</label>
            <input type="text" id="tags" placeholder="Ex: Java, Spring, Backend">
            <div class="hint">Separe por vírgula</div>
        </div>

        <button type="submit">Criar Conta</button>
    </form>

    <div id="response"></div>
</div>

<script>
    const API_URL = "http://localhost:3080/students/new-student"; // Ajuste se a rota for diferente

    document.getElementById('studentForm').addEventListener('submit', function(event) {
        event.preventDefault();

        const responseArea = document.getElementById('response');
        responseArea.style.display = 'block';
        responseArea.textContent = "Processando...";
        responseArea.className = "";

        // Função para transformar string separada por vírgula em Array limpo
        const toList = (str) => str ? str.split(',').map(s => s.trim()).filter(s => s.length > 0) : [];

        const studentData = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            age: parseInt(document.getElementById('age').value) || 0,
            password: document.getElementById('password').value,
            cpf: document.getElementById('cpf').value,
            phone_number: document.getElementById('phone_number').value,

            // ATENÇÃO AO TYPO DO JAVA: 'instituition' em vez de 'institution'
            instituition: document.getElementById('institution').value,

            // Listas
            tag: toList(document.getElementById('tags').value),
            classes: [], // Inicializa vazio na criação

            // Valores Padrão (Não deixe o usuário escolher isso no cadastro)
            level: 1,
            xp: 0
        };

        console.log("Enviando:", studentData);

        fetch(API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(studentData)
        })
            .then(async response => {
                if (response.ok) {
                    const data = await response.json();
                    responseArea.textContent = 'Sucesso! ID gerado: ' + data.id;
                    responseArea.className = 'success';
                    document.getElementById('studentForm').reset();
                } else {
                    const text = await response.text();
                    throw new Error(text || response.statusText);
                }
            })
            .catch(error => {
                console.error(error);
                responseArea.textContent = 'Erro ao criar: ' + error.message;
                responseArea.className = 'error';
            });
    });
</script>

</body>
</html>